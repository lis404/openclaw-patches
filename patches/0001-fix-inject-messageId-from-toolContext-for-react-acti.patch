From a01f209a6bb3382fcf6757230e94e16f1d3884e9 Mon Sep 17 00:00:00 2001
From: Breno <bghaesee@outlook.com>
Date: Fri, 27 Feb 2026 16:14:20 +0000
Subject: [PATCH 1/3] fix: inject messageId from toolContext for react actions
 (#17651)

WhatsApp reactions fail because messageId isn't populated from
toolContext in dispatchChannelMessageAction. Inject it for react
actions when not provided.

Co-authored-by: Lis <lis@hanake0.dev>
---
 src/channels/plugins/message-actions.ts | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/src/channels/plugins/message-actions.ts b/src/channels/plugins/message-actions.ts
index a7b8e6a..52b7b4e 100644
--- a/src/channels/plugins/message-actions.ts
+++ b/src/channels/plugins/message-actions.ts
@@ -99,5 +99,9 @@ export async function dispatchChannelMessageAction(
   if (plugin.actions.supportsAction && !plugin.actions.supportsAction({ action: ctx.action })) {
     return null;
   }
+  // Inject messageId from toolContext for react actions when not provided (#17651)
+  if (ctx.action === "react" && !ctx.params.messageId && ctx.toolContext?.currentMessageId) {
+    ctx.params.messageId = String(ctx.toolContext.currentMessageId);
+  }
   return await plugin.actions.handleAction(ctx);
 }
-- 
2.39.5

